# 证书安装后验证和测试步骤

## ✅ 证书已安装

你已经成功使用以下命令安装了 CA 证书：
```cmd
certutil -addstore -f "Root" C:\Users\jianc\Downloads\rootCA.pem
```

## 下一步：验证和测试

### 步骤 1：验证证书已安装

在命令提示符中执行：

```cmd
certutil -store "Root" | findstr "mkcert"
```

**预期输出：**
应该能看到类似：
```
mkcert ctyun@dty02
```
或
```
mkcert development CA
```

如果看到这些内容，说明证书安装成功！

### 步骤 2：清除 Chrome HSTS 缓存（重要！）

即使证书已安装，如果之前访问过该网站，浏览器可能缓存了 HSTS 策略，需要清除：

1. **打开 Chrome 浏览器**
2. **在地址栏输入：**
   ```
   chrome://net-internals/#hsts
   ```
3. **找到 "Delete domain security policies" 部分**
4. **在输入框中输入：**
   ```
   local.outline.dev
   ```
5. **点击 "Delete" 按钮**
6. **完全关闭 Chrome 浏览器**（关闭所有窗口）
7. **重新打开 Chrome**

### 步骤 3：测试访问

1. **访问网站**
   - 在 Chrome 地址栏输入：`https://local.outline.dev:3300`
   - 或使用 IP 地址：`https://192.168.8.19:3300`（根据你的服务器 IP）

2. **检查证书状态**
   - 点击地址栏的锁图标 🔒
   - 应该显示 **"连接是安全的"** 或 **"证书有效"**
   - 不再显示 "您的连接不是私密连接"

3. **查看证书详情**
   - 点击锁图标 → **"连接是安全的"** → **"证书有效"**
   - 查看证书信息
   - 在 "使用者可选名称 (SAN)" 中应该能看到 `192.168.8.246` 和其他 IP

### 步骤 4：如果仍然有问题

#### 检查 1：确认证书安装位置

```cmd
certutil -store "Root" | findstr "mkcert"
```

如果没有任何输出，说明证书可能没有正确安装。

#### 检查 2：使用隐私模式测试

1. 按 `Ctrl + Shift + N` 打开隐私模式/无痕模式
2. 访问 `https://local.outline.dev:3300`
3. 如果隐私模式下正常，说明是浏览器缓存问题

#### 检查 3：清除所有浏览器数据

1. 按 `Ctrl + Shift + Delete`
2. 选择 **"时间范围"**：**"全部时间"**
3. 勾选：
   - ✅ 缓存的图片和文件
   - ✅ Cookie 及其他网站数据
   - ✅ 已保存的网站数据
4. 点击 **"清除数据"**
5. 完全关闭并重新打开 Chrome

#### 检查 4：验证服务器证书

在命令提示符中执行（如果安装了 OpenSSL）：

```cmd
openssl s_client -connect local.outline.dev:3300 -showcerts
```

或使用 PowerShell：

```powershell
$tcpClient = New-Object System.Net.Sockets.TcpClient('local.outline.dev', 3300)
$sslStream = New-Object System.Net.Security.SslStream($tcpClient.GetStream())
$sslStream.AuthenticateAsClient('local.outline.dev')
$cert = $sslStream.RemoteCertificate
[System.Security.Cryptography.X509Certificates.X509Certificate2]$cert2 = $cert
$cert2 | Select-Object Subject, Issuer, Thumbprint
```

## 成功标志

✅ **证书安装成功：**
- `certutil -store "Root" | findstr "mkcert"` 有输出

✅ **浏览器信任证书：**
- 访问网站时不再显示证书错误
- 地址栏显示锁图标和"连接是安全的"

✅ **证书信息正确：**
- 证书包含你的 IP 地址（192.168.8.246）
- 证书颁发者是 mkcert development CA

## 常见问题

### Q: 安装后 Chrome 仍然显示不安全

**可能原因：**
1. HSTS 缓存未清除
2. 浏览器缓存未清除
3. 证书安装到错误的位置

**解决方案：**
1. 清除 HSTS 缓存（步骤 2）
2. 使用隐私模式测试
3. 验证证书安装位置

### Q: 其他浏览器也需要安装吗？

**答案：**
- ✅ **不需要**，因为安装到系统级别的证书存储
- Chrome、Edge、Firefox 等浏览器都会使用系统证书存储
- 安装一次，所有浏览器都会信任

### Q: 如何卸载证书？

如果需要卸载：

```cmd
certutil -delstore "Root" "mkcert ctyun@dty02"
```

或在证书管理器（certmgr.msc）中手动删除。

## 总结

你现在应该能够：
1. ✅ 在局域网设备上正常访问 `https://local.outline.dev:3300`
2. ✅ 不再看到证书错误提示
3. ✅ 浏览器显示"连接是安全的"

如果还有问题，请告诉我具体的错误信息！
