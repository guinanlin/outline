# Outline 项目架构概要

## 项目概述

Outline 是一个快速、协作的知识库系统，专为团队设计。采用 TypeScript 构建，前后端共享部分代码，支持自托管或云端服务。

## 整体架构

项目采用**单体仓库（Monorepo）**结构，主要包含以下部分：

### 1. 前端（`app/`）
- **技术栈**：React + TypeScript + Vite
- **状态管理**：MobX
- **样式方案**：Styled Components
- **主要目录**：
  - `actions/` - 可复用的操作（导航、打开、创建实体等）
  - `components/` - 跨场景复用的 React 组件
  - `editor/` - 编辑器相关组件
  - `models/` - MobX 状态模型
  - `scenes/` - 完整页面视图
  - `stores/` - 模型集合和获取逻辑
  - `routes/` - 路由定义（异步加载）

### 2. 后端（`server/`）
- **技术栈**：Koa + TypeScript
- **数据库**：PostgreSQL（通过 Sequelize ORM）
- **缓存/队列**：Redis + Bull
- **授权**：cancan 策略
- **主要目录**：
  - `routes/` - API 路由（`api/` 和 `auth/`）
  - `models/` - Sequelize 数据模型
  - `commands/` - 跨模型的复杂命令
  - `policies/` - 授权逻辑
  - `presenters/` - 数据模型到前端的 JSON 转换
  - `queues/` - 异步队列定义
  - `services/` - 服务启动（API、Worker 等）

### 3. 共享代码（`shared/`）
前后端共享的代码：
- `components/` - 共享的 React 组件
- `editor/` - 基于 Prosemirror 的文本编辑器
- `i18n/` - 国际化配置和翻译文件
- `utils/` - 共享工具方法

### 4. 插件系统（`plugins/`）
用于扩展功能的插件系统

## 后端服务架构

后端采用**微服务架构**，包含以下服务：

1. **Web 服务** - 主服务，提供应用和 API
2. **WebSocket 服务** - 与前端实时通信
3. **协作服务（Collaboration）** - 协调文档的实时编辑和更新
4. **Worker 服务** - 处理异步队列任务
5. **Admin 服务** - 开发环境下的队列调试界面

这些服务可以：
- 运行在同一进程（默认）
- 通过 `--services` 参数或 `SERVICES` 环境变量选择运行
- 部署到不同服务器（如协作服务可独立部署）

## 核心技术特性

- **实时协作**：基于 WebSocket 和 Y.js 的协同编辑
- **富文本编辑**：基于 Prosemirror
- **类型安全**：全栈 TypeScript
- **响应式设计**：支持移动端
- **国际化**：多语言支持

## 数据存储

- **PostgreSQL**：主要数据存储
- **Redis**：缓存和队列管理

## 开发工具链

- **构建工具**：Vite（前端）、Node.js（后端）
- **代码质量**：Prettier（格式化）、Oxlint（代码检查）
- **测试**：Jest
- **包管理**：Yarn

---

这份概要涵盖了 Outline 的核心架构。如需更详细的说明，可参考 `docs/ARCHITECTURE.md`。
